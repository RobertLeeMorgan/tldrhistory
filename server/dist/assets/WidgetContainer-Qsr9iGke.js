import{j as e,r as m,h,i as j,k as b,R as g,f as C,m as _}from"./index-B6wW9msG.js";import{f as w,g as v,a as $}from"./formatWidget-DsoUn4p-.js";function p({title:s,value:t,desc:n,format:a}){return e.jsxs("div",{className:"stat place-items-center text-sm py-4 px-0 md:px-4 md:px-6",children:[s&&e.jsx("div",{className:"stat-title text-slate-300",children:s}),e.jsx("div",{className:a||"stat-value text-slate-200 text-xl md:text-4xl",children:t}),n&&e.jsx("div",{className:"stat-desc text-slate-300",children:n})]})}function N({year:s}){const[t,n]=m.useState({population:1e4,year_start:-3e5,year_end:-200001}),[a,c]=m.useState();let u=v(s);const r=$(a);m.useEffect(()=>{u!==a&&c(u)},[a,u]);const{data:o}=h({queryKey:["population"],queryFn:j,throwOnError:!0}),{data:l}=h({queryKey:["popular",a],queryFn:()=>b(a),throwOnError:!0});m.useEffect(()=>{if(o&&o.population){const x=o.population.find(y=>s>=y.year_start&&s<=y.year_end);x&&x!==t&&n(x)}},[o,s,t]);const i=l&&l.length>0?l[0]["post.name"]:"",f=l&&l.length>0?l[0]["post.type"]:"",d=l&&l.length>0?l[0].likes:"";return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"stats bg-purple-800 stats-vertical border bottom-0 left:0 md:right-0 border-black h-full overflow-hidden rounded-none shadow fixed z-50 w-min ",children:[e.jsx(p,{value:r.charAt(0)==="-"?r.slice(1):r,desc:r.charAt(0)==="-"?"Century BCE":"Century CE"}),e.jsx(p,{title:"Global Population",value:w(t.population)}),e.jsx(p,{title:"Most Popular",value:i?i.toUpperCase():"-",desc:`${f.charAt(0).toUpperCase()+f.slice(1)}, ${d} like(s)`,format:`${i.length<8?"text-xl leading-6":"text-sm leading-2"} md:text-xl md:leading-5 text-slate-300 font-semibold text-ellipsis overflow-hidden text-wrap w-40 text-center`})]})})}function E({centuries:s}){return e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-12"}),s.map(t=>e.jsx("th",{className:"w-12 text-sm font-normal"},t))]})})}const F=({centuries:s,continent:t,rowIndex:n,row:a})=>e.jsxs("tr",{children:[n===0&&e.jsx("td",{className:"hidden md:table-cell left-0 h-full fixed bg-slate-950",children:e.jsx("div",{className:"md:w-40 md:text-nowrap text-center text-slate-300",children:t})}),s.map((c,u)=>{const r=a.filter(l=>Math.floor(l.start_year/100)<=c&&Math.floor(l.end_year/100)>=c);let o;return r.length>0?o=r.filter((i,f,d)=>f===d.findIndex(x=>x.name===i.name)).map((i,f)=>{const d=Math.ceil((i.end_year-i.start_year)/100);return f===0&&u===Math.floor(i.start_year/100)+50?e.jsx("td",{className:"text-center text-sm bg-fuchsia-700 border border-slate-900 border-2 rounded-md shadow truncate",colSpan:d,children:i.name.toUpperCase()},`${t}-${c}-${n}-${f}`):null}):o=e.jsx("td",{},`${t}-${c}-${n}`),o})]},`${t}-${n}`),q=g.memo(F);function M({centuries:s,continents:t,civil:n}){return e.jsx("tbody",{children:t.map(a=>{const c=n.civil.filter(r=>r.country.continent===a);c.sort((r,o)=>r.start_year-o.start_year);let u=[];return c.forEach(r=>{let o=!1;for(let l=0;l<u.length;l++)if(!u[l].some(d=>r.start_year<=d.end_year&&r.end_year>=d.start_year||d.start_year<=r.end_year&&d.end_year>=r.start_year)){u[l].push(r),o=!0;break}o||u.push([r])}),u.map((r,o)=>e.jsx(q,{continent:a,rowIndex:o,centuries:s,row:r,fallback:e.jsx(e.Fragment,{})},`${a}-${o}`))})})}function k({civil:s}){const t=m.useMemo(()=>{const a=[];for(let c=-50;c<=25;c++)c!==0&&a.push(c);return a},[]),n=m.useMemo(()=>[...new Set(s.civil.map(a=>a.country.continent))],[s]);return e.jsxs("table",{className:"table-fixed w-12 bg-gray-900 pb-4",children:[e.jsx(E,{centuries:t}),e.jsx(M,{centuries:t,continents:n,civil:s})]})}function R({civil:s,year:t}){const n=m.useRef(null);return m.useEffect(()=>{const a=Math.floor(t/100)+50;if(n.current){const u=n.current.clientWidth-150,r=a*48-u/2;n.current.scrollLeft=r}},[t]),e.jsx("div",{className:"overflow-hidden scroll-smooth",ref:n,children:e.jsx(k,{civil:s})})}function W(){const{year:s}=C(),{data:t}=h({queryKey:["civil"],queryFn:_,throwOnError:!0});return e.jsx(e.Fragment,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(N,{year:s}),e.jsx(R,{civil:t,year:s})]})})}export{W as default};
